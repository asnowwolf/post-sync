# Post Sync

**Post Sync** æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…· (CLI)ï¼Œæ—¨åœ¨å¸®åŠ©å†…å®¹åˆ›ä½œè€…å°†æœ¬åœ°çš„ Markdown æ–‡ä»¶è‡ªåŠ¨å‘å¸ƒåˆ°å¾®ä¿¡å…¬ä¼—å·ã€‚å®ƒèƒ½å¤Ÿæ™ºèƒ½å¤„ç†
Markdown ä¸­çš„å›¾ç‰‡èµ„æºï¼Œè‡ªåŠ¨ç”Ÿæˆå°é¢ï¼Œå¹¶æ”¯æŒå¢é‡æ›´æ–°ï¼Œæå¤§åœ°ç®€åŒ–äº†å…¬ä¼—å·æ–‡ç« çš„å‘å¸ƒæµç¨‹ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- **Markdown åŸç”Ÿæ”¯æŒ**: è§£æ Markdown å†…å®¹å¹¶è½¬æ¢ä¸ºå¾®ä¿¡å…¬ä¼—å·å…¼å®¹çš„æ ¼å¼ã€‚
- **è‡ªåŠ¨å›¾ç‰‡å¤„ç†**:
    - è‡ªåŠ¨æ‰«æ Markdown ä¸­çš„å›¾ç‰‡é“¾æ¥ï¼ˆæœ¬åœ°è·¯å¾„æˆ–ç½‘ç»œ URLï¼‰ã€‚
    - è‡ªåŠ¨ä¸Šä¼ å›¾ç‰‡åˆ°å¾®ä¿¡å…¬ä¼—å·ç´ æåº“ã€‚
    - è‡ªåŠ¨æ›¿æ¢æ–‡ç« ä¸­çš„å›¾ç‰‡é“¾æ¥ä¸ºå¾®ä¿¡æ°¸ä¹…é“¾æ¥ã€‚
- **æ™ºèƒ½å°é¢ç®¡ç†**: è‡ªåŠ¨æ£€æµ‹ä¸ Markdown æ–‡ä»¶åŒåçš„ `.png` å›¾ç‰‡ä½œä¸ºæ–‡ç« å°é¢å¹¶ä¸Šä¼ ã€‚
- **å¢é‡å‘å¸ƒ**: åŸºäºæ–‡ä»¶å“ˆå¸Œ (Hash) æ£€æµ‹å†…å®¹å˜åŒ–ï¼Œä»…å¤„ç†æœ‰æ›´æ–°çš„æ–‡ä»¶ï¼Œé¿å…é‡å¤ä¸Šä¼ ã€‚
- **è‰ç¨¿ç®±ç®¡ç†**: `create` å‘½ä»¤å°†æ–‡ç« ä¸Šä¼ è‡³å…¬ä¼—å·è‰ç¨¿ç®±ã€‚
- **ä¸€é”®å‘å¸ƒ**: `publish` å‘½ä»¤å°†å·²ä¸Šä¼ çš„è‰ç¨¿æ­£å¼å‘å¸ƒã€‚
- **æ— éœ€ä»£ç†é…ç½®**: å†…ç½®åå‘ä»£ç†é…ç½®ï¼Œæ— éœ€ç¹ççš„ç½‘ç»œè®¾ç½®å³å¯è°ƒç”¨å¾®ä¿¡ APIã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Node.js >= 18.0.0
- npm æˆ– yarn

### 2. å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-repo/post-sync.git
cd post-sync

# å®‰è£…ä¾èµ–
npm install

# ç¼–è¯‘é¡¹ç›®
npm run build
```

### 3. é…ç½®

å·¥å…·å°†ä½¿ç”¨ `~/.post-sync` ç›®å½•ä½œä¸ºå…¶å·¥ä½œç›®å½•ï¼Œå¹¶åœ¨å…¶ä¸­ç®¡ç†é…ç½®å’Œæ•°æ®åº“æ–‡ä»¶ã€‚

è¯·åœ¨ `~/.post-sync/config.json` æ–‡ä»¶ä¸­é…ç½®ä½ çš„å¾®ä¿¡å…¬ä¼—å·å‡­è¯å’Œ profileï¼š

```json
{
  "wechatApiBaseUrl": "https://proxy-wechat.zhizuo.biz",
  "profiles": [
    {
      "id": "default",
      "appId": "your_default_app_id",
      "appSecret": "your_default_app_secret"
    },
    {
      "id": "tech_blog",
      "appId": "your_tech_blog_app_id",
      "appSecret": "your_tech_blog_app_secret"
    }
  ]
}
```

> **æ³¨æ„**:
> - `wechatApiBaseUrl` æ˜¯å…¬å…±é…ç½®ï¼Œé€‚ç”¨äºæ‰€æœ‰ profileã€‚
> - `profiles` æ•°ç»„ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªå…¬ä¼—å·é…ç½®ï¼Œæ¯ä¸ªé…ç½®éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ `id`ã€‚
> - å¦‚æœæœªæŒ‡å®š `--profile` å‚æ•°ï¼Œå°†ä½¿ç”¨ `profiles` åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ª profile ä½œä¸ºé»˜è®¤å€¼ã€‚
> - è¯·ç¡®ä¿ä½ çš„å…¬ä¼—å·æ˜¯æœåŠ¡å·æˆ–å·²è®¤è¯çš„è®¢é˜…å·ï¼Œå¹¶ä¸”æ‹¥æœ‰è°ƒç”¨ç›¸å…³æ¥å£çš„æƒé™ã€‚
> - å¾…å‘å¸ƒç›®å½•ï¼ˆå³ä½ å­˜æ”¾ Markdown æ–‡ä»¶çš„ç›®å½•ï¼‰å°†è¢«è§†ä¸º**åªè¯»**ã€‚å·¥å…·ä¸ä¼šåœ¨å…¶ä¸­å†™å…¥ä»»ä½•æ–‡ä»¶æˆ–åˆ›å»º `.ps` ç›®å½•ã€‚
> - æ•°æ®åº“ä¸­å°†ä½¿ç”¨**ç»å¯¹è·¯å¾„**è®°å½•è¢«å‘å¸ƒçš„æ–‡ä»¶ã€‚


## ğŸ“– ä½¿ç”¨æŒ‡å—

å·¥å…·ä¸»è¦åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒå‘½ä»¤ï¼š`create`ã€`publish` å’Œ `post`ã€‚

### 1. åˆ›å»ºè‰ç¨¿ (Create)

è¯»å–æŒ‡å®šç›®å½•ä¸‹çš„ Markdown æ–‡ä»¶ï¼Œå¤„ç†å›¾ç‰‡ç´ æï¼Œå¹¶å°†å…¶ä½œä¸ºè‰ç¨¿ä¸Šä¼ åˆ°å¾®ä¿¡å…¬ä¼—å·ã€‚

```bash
# è¿è¡Œæ–¹å¼ 1: ä½¿ç”¨ npm script (ä½¿ç”¨é»˜è®¤ profile)
npm start create ./contents/my-article.md

# è¿è¡Œæ–¹å¼ 2: ä½¿ç”¨ npm script (æŒ‡å®š profile)
npm start create ./contents/my-article.md -- --profile tech_blog

# è¿è¡Œæ–¹å¼ 3: å¦‚æœå·²å…¨å±€å®‰è£…æˆ–åœ¨ dist ç›®å½•ä¸‹ (ä½¿ç”¨é»˜è®¤ profile)
node dist/index.js create ./contents/

# è¿è¡Œæ–¹å¼ 4: å¦‚æœå·²å…¨å±€å®‰è£…æˆ–åœ¨ dist ç›®å½•ä¸‹ (æŒ‡å®š profile)
node dist/index.js create ./contents/ --profile tech_blog
```

**å‘½ä»¤è¡Œä¸ºè¯´æ˜**:

- **æ‰«æ**: é€’å½’æ‰«ææŒ‡å®šè·¯å¾„ä¸‹çš„æ‰€æœ‰ `.md` æ–‡ä»¶ã€‚
- **å°é¢**: è‡ªåŠ¨æŸ¥æ‰¾ä¸ `.md` æ–‡ä»¶åŒåçš„ `.png` å›¾ç‰‡ï¼ˆä¾‹å¦‚ `article.md` å¯¹åº” `article.png`
  ï¼‰ä½œä¸ºå°é¢ã€‚å¦‚æœæ­£æ–‡ä¸­å¼•ç”¨äº†è¯¥å°é¢å›¾ï¼Œå·¥å…·ä¼šè‡ªåŠ¨å°†å…¶ä»æ­£æ–‡ä¸­ç§»é™¤ï¼Œé¿å…é‡å¤æ˜¾ç¤ºã€‚
- **æ ‡é¢˜**: è‡ªåŠ¨æå– Markdown æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªä¸€çº§æ ‡é¢˜ (`# æ ‡é¢˜`) ä½œä¸ºå…¬ä¼—å·æ–‡ç« æ ‡é¢˜ã€‚
- **å»é‡**: é¦–æ¬¡è¿è¡Œä¼šå»ºç«‹æœ¬åœ°æ•°æ®åº“è®°å½•ã€‚å†æ¬¡è¿è¡Œæ—¶ï¼Œå¦‚æœæ–‡ä»¶å†…å®¹æœªå‘ç”Ÿå˜æ›´ï¼ˆHash å€¼ä¸€è‡´ï¼‰ï¼Œåˆ™ä¼šè‡ªåŠ¨è·³è¿‡ã€‚

### 2. å‘å¸ƒæ–‡ç«  (Publish)

å°†å·²ç»é€šè¿‡ `create` å‘½ä»¤ä¸Šä¼ åˆ°è‰ç¨¿ç®±çš„æ–‡ç« æ­£å¼å‘å¸ƒã€‚

```bash
# å‘å¸ƒæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ç«  (ä½¿ç”¨é»˜è®¤ profile)
npm start publish ./contents/my-article.md

# å‘å¸ƒæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ç«  (æŒ‡å®š profile)
npm start publish ./contents/my-article.md -- --profile tech_blog
```

**å‘½ä»¤è¡Œä¸ºè¯´æ˜**:

- å·¥å…·ä¼šæ ¹æ®æ–‡ä»¶è·¯å¾„åœ¨æœ¬åœ°æ•°æ®åº“ä¸­æŸ¥æ‰¾å¯¹åº”çš„è‰ç¨¿è®°å½•ã€‚
- åªæœ‰æˆåŠŸæ‰§è¡Œè¿‡ `create` ä¸”å­˜åœ¨æœ‰æ•ˆ `media_id` çš„æ–‡ç« æ‰èƒ½è¢«å‘å¸ƒã€‚
- å‘å¸ƒæˆåŠŸåï¼Œä¼šè¿”å› `publish_id` å¹¶åœ¨æ—¥å¿—ä¸­ç¡®è®¤ã€‚

### 3. ä¸€é”®å‘å¸ƒ (Post)

æ­¤å‘½ä»¤ç»“åˆäº† `create` å’Œ `publish` çš„åŠŸèƒ½ï¼Œç®€åŒ–äº†æ–‡ç« çš„å‘å¸ƒæµç¨‹ã€‚å®ƒä¼šé¦–å…ˆå¤„ç† Markdown æ–‡ä»¶ç”Ÿæˆè‰ç¨¿ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™ç«‹å³å°è¯•å‘å¸ƒæ–‡ç« ã€‚

```bash
# ä¸€é”®å‘å¸ƒæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ç«  (ä½¿ç”¨é»˜è®¤ profile)
npm start post ./contents/my-article.md

# ä¸€é”®å‘å¸ƒæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ç«  (æŒ‡å®š profile)
npm start post ./contents/my-article.md -- --profile tech_blog

# æˆ–è€…å‘å¸ƒæ•´ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ›´æ–°æ–‡ç«  (ä½¿ç”¨é»˜è®¤ profile)
npm start post ./contents/

# æˆ–è€…å‘å¸ƒæ•´ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ›´æ–°æ–‡ç«  (æŒ‡å®š profile)
npm start post ./contents/ --profile tech_blog
```

**å‘½ä»¤è¡Œä¸ºè¯´æ˜**:

- **æ™ºèƒ½åˆ¤æ–­**: å¯¹äºæœªå‘å¸ƒè¿‡çš„æ–°æ–‡ç« æˆ–å†…å®¹æœ‰æ›´æ–°çš„æ—§æ–‡ç« ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œ `create` -> `publish` æµç¨‹ã€‚
- **å¢é‡æ›´æ–°**: å¦‚æœæ–‡ç« å†…å®¹æœªå‘ç”Ÿå˜åŒ–ä¸”å·²å‘å¸ƒï¼Œåˆ™è·³è¿‡å¤„ç†ã€‚
- **é”™è¯¯å¤„ç†**: å¦‚æœ `create` æ­¥éª¤å¤±è´¥ï¼ˆä¾‹å¦‚å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼‰ï¼Œåˆ™ä¸ä¼šè¿›è¡Œ `publish`ã€‚

## ğŸ“‚ æ–‡ä»¶ç»„ç»‡è§„èŒƒç¤ºä¾‹

å»ºè®®æŒ‰ä»¥ä¸‹ç»“æ„ç»„ç»‡ä½ çš„å†…å®¹æ–‡ä»¶ï¼Œä»¥ä¾¿å·¥å…·èƒ½æ­£ç¡®è¯†åˆ«å°é¢å’Œå†…å®¹ï¼š

```text
/contents
  â”œâ”€â”€ 001-hello-world.md       # æ–‡ç« å†…å®¹
  â”œâ”€â”€ 001-hello-world.png      # å¯¹åº”çš„å°é¢å›¾ (å¿…é¡»åŒåä¸”ä¸º png)
  â””â”€â”€ assets/
      â”œâ”€â”€ image1.jpg           # æ–‡ç« å†…å¼•ç”¨çš„å…¶ä»–å›¾ç‰‡
      â””â”€â”€ image2.png
```

## ğŸ› ï¸ å¼€å‘

```bash
# è¿è¡Œæµ‹è¯•
npm test

# è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯• (E2E)
# æ³¨æ„ï¼šE2E æµ‹è¯•ä¼šæ¸…ç©º .ps ç›®å½•ä¸‹çš„æ•°æ®åº“
npm run build && npx vitest run tests/e2e.test.ts
```

## ğŸ“„ License

MIT
